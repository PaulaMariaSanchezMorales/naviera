// <auto-generated/>
#pragma warning disable 1591
#pragma warning disable 0414
#pragma warning disable 0649
#pragma warning disable 0169

namespace ProyectoMaersk.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using ProyectoMaersk;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\_Imports.razor"
using ProyectoMaersk.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 1 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\Pages\ReservasEditar.razor"
using Microsoft.AspNetCore.WebUtilities;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\Pages\ReservasEditar.razor"
using Microsoft.Extensions.Configuration;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\Pages\ReservasEditar.razor"
using MySqlConnector;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\Pages\ReservasEditar.razor"
using Clases;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/ReservasEditar")]
    public partial class ReservasEditar : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
        }
        #pragma warning restore 1998
#nullable restore
#line 134 "C:\Users\osanc\source\repos\naviera\ProyectoMaersk\Pages\ReservasEditar.razor"
 
    int Id = 0;
    Reserva reserva = new Reserva();

    List<Pais> Paises_Origen = new List<Pais>(); //listado de los países existentes
    List<Pais> Paises_Destino = new List<Pais>();

    List<Puerto> Puertos_Origen = new List<Puerto>();
    List<Puerto> Puertos_Destino = new List<Puerto>();

    List<Tipo_carga> Tipo_Carga = new List<Tipo_carga>();

    List<Valor> Valores = new List<Valor>();

    List<Tipo_contenedor> Tipo_Contenedores = new List<Tipo_contenedor>();

    //para que los puertos que aparezcan solo sean los del país seleccionado
    //puertos de origen
    void LlenaPuertosOrigen(String Pais)
    {
        //puerto origen
        Puertos_Origen.Clear();
        String connString = config.GetConnectionString("MySqlNaviera"); //variable de conexión a la base
        using var connectionPuertos = new MySqlConnection(connString);
        {
            connectionPuertos.Open(); //apertura de la base

            using var commandPuertos = new MySqlCommand("SELECT * FROM puertos where pais = '" + Pais + "'", connectionPuertos);
            {
                using var readerPuertos = commandPuertos.ExecuteReader();
                {
                    while (readerPuertos.Read())
                    {
                        var puerto = new Puerto();
                        puerto.Codigo = readerPuertos["codigo"].ToString();
                        puerto.Nombre = readerPuertos["nombre"].ToString();
                        Puertos_Origen.Add(puerto);
                    }
                }
            }
        }
    }
    void Llena_Puertos_Origen_Evento(ChangeEventArgs e)
    {
        // Recibe como parametro el dato que cambio en e.value
        String Pais = e.Value.ToString();
        reserva.Puerto_Origen = "";
        LlenaPuertosOrigen(Pais);
    }

    //para que los puertos que aparezcan solo sean los del país seleccionado
    //puertos destino
    void LlenaPuertosDestino(String Pais)
    {
        //puerto origen
        Puertos_Destino.Clear();
        String connString = config.GetConnectionString("MySqlNaviera");
        using var connectionPuertos = new MySqlConnection(connString);
        {
            connectionPuertos.Open();

            using var commandPuertos = new MySqlCommand("SELECT * FROM puertos where pais = '" + Pais + "'", connectionPuertos);
            {
                using var readerPuertos = commandPuertos.ExecuteReader();
                {
                    while (readerPuertos.Read())
                    {
                        var puerto = new Puerto();
                        puerto.Codigo = readerPuertos["codigo"].ToString();
                        puerto.Nombre = readerPuertos["nombre"].ToString();
                        Puertos_Destino.Add(puerto);
                    }
                }
            }
        }
    }
    void Llena_Puertos_Destino_Evento(ChangeEventArgs e)
    {
        // Recibe como parametro el dato que cambio en e.value
        String Pais = e.Value.ToString();
        reserva.Puerto_Destino = "";
        LlenaPuertosDestino(Pais);
    }



    void Llena_Combos() //no regresa ningún resultado void (lista de todos lo países)
    {
        String connString = config.GetConnectionString("MySqlNaviera");
        using var connection = new MySqlConnection(connString);
        {
            //paises
            connection.Open();
            using var command1 = new MySqlCommand("SELECT * FROM paises;", connection);
            {
                using var reader1 = command1.ExecuteReader();
                {
                    while (reader1.Read())
                    {
                        var pais = new Pais();
                        pais.Codigo = reader1["codigo"].ToString();
                        pais.Nombre = reader1["nombre"].ToString();
                        Paises_Origen.Add(pais);
                        Paises_Destino.Add(pais);
                    }
                }
            }

            //cargas
            using var command3 = new MySqlCommand("SELECT * FROM tipo_carga;", connection);
            {
                using var reader3 = command3.ExecuteReader();
                {
                    while (reader3.Read())
                    {
                        var carga = new Tipo_carga();
                        carga.Nombre = reader3["nombre"].ToString();
                        Tipo_Carga.Add(carga);
                    }
                }
            }

            //valores
            using var command4 = new MySqlCommand("SELECT * FROM valores;", connection);
            {
                using var reader4 = command4.ExecuteReader();
                {
                    while (reader4.Read())
                    {
                        var valor = new Valor();
                        valor.Cantidad = reader4["cantidades"].ToString();
                        Valores.Add(valor);
                    }
                }
            }

            //contenedores
            using var command5 = new MySqlCommand("SELECT * FROM tipo_contenedores;", connection);
            {
                using var reader5 = command5.ExecuteReader();
                {
                    while (reader5.Read())
                    {
                        var contenedor = new Tipo_contenedor();
                        contenedor.Nombre = reader5["nombre"].ToString();
                        contenedor.Codigo = reader5["codigo"].ToString();
                        Tipo_Contenedores.Add(contenedor);
                    }
                }
            }
        }
    }

    void grabar()
    {
        String connString = config.GetConnectionString("MySqlNaviera");
        using var connection = new MySqlConnection(connString);
        {
            String q = "";

            connection.Open();
            if (reserva.Id > 0)
            {
                q = "UPDATE reserva_contenedor SET ";
                q = q + "empresa = '" + reserva.Empresa + "',";
                q = q + " nit = '" + reserva.Nit + "',";
                q = q + " direccion = '" + reserva.Direccion + "',";
                q = q + " puerto_origen = '" + reserva.Puerto_Origen + "',";
                q = q + " pais_origen = '" + reserva.Pais_Origen + "',";
                q = q + " hora_salida = '" + reserva.Hora_Salida + "',";
                q = q + " puerto_destino = '" + reserva.Puerto_Destino + "',";
                q = q + " pais_destino = '" + reserva.Pais_Destino + "',";
                q = q + " hora_llegada = '" + reserva.Hora_Llegada + "',";
                q = q + " receptor = '" + reserva.Receptor + "',";
                q = q + " contraseña_recepcion = '" + reserva.Contraseña_Recepcion + "',";
                q = q + " tipo_carga = '" + reserva.Tipo_Carga + "',";
                q = q + " descripcion_carga = '" + reserva.Descripcion + "',";
                q = q + " peso_carga = '" + reserva.Peso + "',";
                q = q + " valor_carga = '" + reserva.Valor + "',";
                q = q + " tipo_contenedor = '" + reserva.Tipo_Contenedor + "'";

                q = q + " where id = '" + reserva.Id + "'";
            }
            else
            {
                reserva.Codigo = reserva.Tipo_Contenedor.Substring(0, 2) + reserva.Puerto_Origen + reserva.Pais_Origen + reserva.Pais_Destino; //substring(posicion que empieza, longitud)
                reserva.Contraseña_Recepcion = Guid.NewGuid().ToString("N").Substring(0, 6); //generar numeros random, es una funcion ya por los sistemas para generar un id unico

                q = q + "INSERT INTO reserva_contenedor(codigo_contenedor, empresa, nit, direccion, puerto_origen, pais_origen, hora_salida, puerto_destino, pais_destino, hora_llegada, receptor, contraseña_recepcion, tipo_carga, descripcion_carga, peso_carga, valor_carga, tipo_contenedor)" +
                    " values ('" + reserva.Codigo + "','" + reserva.Empresa + "','" + reserva.Nit + "','" + reserva.Direccion + "','" + reserva.Puerto_Origen + "','" + reserva.Pais_Origen + "','" + reserva.Hora_Salida + "','" + reserva.Puerto_Destino + "','" + reserva.Pais_Destino + "','" + reserva.Hora_Llegada + "','" + reserva.Receptor + "','" + reserva.Contraseña_Recepcion + "','" + reserva.Tipo_Carga + "','" + reserva.Descripcion + "','" + reserva.Peso + "','" + reserva.Valor + "','" + reserva.Tipo_Contenedor + "')";
            }
            using var command = new MySqlCommand(q, connection);
            var resultado = command.ExecuteNonQuery();
        }

        NavManager.NavigateTo("/");
    }

    protected override void OnInitialized()
    {
        var uri = NavManager.ToAbsoluteUri(NavManager.Uri);
        if (QueryHelpers.ParseQuery(uri.Query).TryGetValue("Id", out var param))
        {
            String parametro = param.First();
            if (parametro != null)
            {
                Int32.TryParse(parametro, out Id);
            }
        }

        Llena_Combos();

        String connString = config.GetConnectionString("MySqlNaviera");
        using var connection = new MySqlConnection(connString);
        {
            connection.Open();
            String q = "SELECT * FROM reserva_contenedor where id = '" + Id + "';";
            using var command = new MySqlCommand(q, connection);
            using var reader = command.ExecuteReader();
            while (reader.Read())
            {
                reserva.Id = (int)reader["id"];
                reserva.Codigo = reader["Codigo_contenedor"].ToString();
                reserva.Empresa = reader["Empresa"].ToString();
                reserva.Nit = reader["Nit"].ToString();
                reserva.Direccion = reader["Direccion"].ToString();
                reserva.Puerto_Origen = reader["Puerto_Origen"].ToString();
                reserva.Pais_Origen = reader["Pais_Origen"].ToString();
                DateTime f1;
                DateTime.TryParse(reader["Hora_Salida"].ToString(), out f1); //realizando conversión de fechas, se tienen dos parámetros (a convertir, ya convertido)
                reserva.Hora_Salida = f1.ToString("yyyy-MM-ddTHH:mm");
                reserva.Puerto_Destino = reader["Puerto_Destino"].ToString();
                reserva.Pais_Destino = reader["Pais_Destino"].ToString();
                DateTime f2;
                DateTime.TryParse(reader["Hora_Llegada"].ToString(), out f2); 
                reserva.Hora_Llegada = f2.ToString("yyyy-MM-ddTHH:mm");
                reserva.Receptor = reader["Receptor"].ToString();
                reserva.Contraseña_Recepcion = reader["Contraseña_Recepcion"].ToString();
                reserva.Tipo_Carga = reader["Tipo_Carga"].ToString();
                reserva.Descripcion = reader["Descripcion_carga"].ToString();
                reserva.Peso = reader["Peso_carga"].ToString();
                reserva.Valor = reader["Valor_carga"].ToString();
                reserva.Tipo_Contenedor = reader["Tipo_Contenedor"].ToString();
                LlenaPuertosOrigen(reserva.Pais_Origen);
            }
        }
    }

#line default
#line hidden
#nullable disable
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private NavigationManager NavManager { get; set; }
        [global::Microsoft.AspNetCore.Components.InjectAttribute] private Microsoft.Extensions.Configuration.IConfiguration config { get; set; }
    }
}
#pragma warning restore 1591
